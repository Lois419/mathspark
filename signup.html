<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MathSpark - Sign Up</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&family=Poppins:wght@400;700&display=swap"
        rel="stylesheet">
    <link rel="icon" href="./images/favicon.png" type="image/png">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
        integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        .signup-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
            padding: 40px 0;
        }

        .signup-box {
            background-color: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .signup-box h2 {
            margin-bottom: 30px;
            color: #0056b3;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }

        .form-group input[type="email"],
        .form-group input[type="password"] {
            width: 100%;
            padding: 12px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
        }

        .signup-btn {
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 1.1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .signup-btn:hover {
            background-color: #0056b3;
        }

        .login-link {
            margin-top: 20px;
            font-size: 0.9em;
        }

        .login-link a {
            color: #007bff;
            font-weight: bold;
        }

        .error-message {
            color: red;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%; /* Adjusted from `calc(50% + 5px)` to align better */
            transform: translateY(-50%);
            cursor: pointer;
            color: #777;
            font-size: 1.1em;
        }

        .password-strength-bar {
            width: 100%;
            height: 5px;
            background-color: #ddd;
            margin-top: 5px;
            border-radius: 5px;
            overflow: hidden;
        }

        .strength-bar {
            height: 100%;
            width: 0%;
            background-color: red;
            transition: width 0.3s ease, background-color 0.3s ease;
        }

        .strength-label {
            text-align: left;
            margin-top: 5px;
            font-size: 0.9em;
            color: #777;
        }

        .password-wrapper {
            position: relative;
        }

        .password-wrapper input {
            padding-right: 40px; /* space for the eye icon */
        }
    </style>
</head>

<body>
    <header>
        <div class="container">
            <div class="site-title">
                <img src="./images/favicon.png" alt="MathSpark Logo" class="site-logo" />
                MathSpark
            </div>
            <nav>
                <ul>
                    <li><a href="/">Home</a></li>
                    <li><a href="/lessons.html">Lessons</a></li>
                    <li><a href="/quizzes.html">Quizzes</a></li>
                    <li><a href="/test.html">Test</a></li>
                    <li><a href="/about.html">About</a></li>
                    <li><a href="/contact.html">Contact</a></li>
                </ul>
            </nav>
            <div class="auth-buttons">
                <a href="/login.html" class="btn">Login</a>
                <a href="/signup.html" class="btn primary">Sign Up</a>
            </div>
        </div>
    </header>

    <main>
        <section class="signup-container">
            <div class="signup-box">
                <h2>Sign Up for MathSpark</h2>
                <form id="signup-form">
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required />
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <div class="password-wrapper">
                            <input type="password" id="password" name="password" required />
                            <i class="far fa-eye toggle-password" id="togglePassword"></i>
                        </div>
                        <div class="password-strength-bar">
                            <div class="strength-bar" id="strengthBar"></div>
                        </div>
                        <p id="strengthLabel" class="strength-label"></p>
                    </div>
                    <div class="form-group">
                        <label for="confirm-password">Confirm Password</label>
                        <div class="password-wrapper">
                            <input type="password" id="confirm-password" name="confirm-password" required />
                            <i class="far fa-eye toggle-password" id="toggleConfirmPassword"></i>
                        </div>
                    </div>
                    <div id="error-message" class="error-message"></div>
                    <button type="submit" class="signup-btn">Sign Up</button>
                </form>
                <div class="login-link">
                    Already have an account? <a href="/login.html">Log in here</a>
                </div>
            </div>
        </section>
    </main>

    <footer>
        <div class="container">
            <nav>
                <ul>
                    <li><a href="/privacy.html">Privacy Policy</a></li>
                    <li><a href="/terms.html">Terms of Service</a></li>
                    <li><a href="/help.html">Help Center</a></li>
                </ul>
            </nav>
            <p>&copy; <span id="current-year"></span> MathSpark. All rights reserved.</p>
        </div>
    </footer>
    <script src="https://www.gstatic.com/firebasejs/9.2.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.2.0/firebase-auth.js"></script>
    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBt8cAMTWrwrysLVjOATlgvtfAhvTyRwkY",
            authDomain: "mathspark-33.firebaseapp.com",
            projectId: "mathspark-33",
            storageBucket: "mathspark-33.appspot.com",
            messagingSenderId: "105836546565",
            appId: "1:105836546565:web:65ec87adc2ebb33aea2a6c",
            measurementId: "G-Q242XZZ8V2"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();

        document.getElementById("current-year").textContent = new Date().getFullYear();

        const togglePasswordVisibility = (elementId, passwordId) => {
            const toggle = document.querySelector(elementId);
            const password = document.querySelector(passwordId);

            if (!toggle || !password) return; // exit if elements are missing

            toggle.addEventListener('click', function(e) {
                const type = password.getAttribute('type') === 'password' ? 'text' : 'password';
                password.setAttribute('type', type);

                // update the icon based on the password type
                this.classList.toggle('fa-eye');
                this.classList.toggle('fa-eye-slash');
            });
        };

        togglePasswordVisibility('#togglePassword', '#password');
        togglePasswordVisibility('#toggleConfirmPassword', '#confirm-password');

        const signupForm = document.getElementById('signup-form');
        if (signupForm) {
            signupForm.addEventListener('submit', function(event) {
                event.preventDefault();

                const email = document.getElementById('email').value;
                const password = document.getElementById('password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                const errorMessage = document.getElementById('error-message');

                if (password !== confirmPassword) {
                    errorMessage.textContent = "Passwords do not match";
                    return;
                } else {
                    errorMessage.textContent = ""; // Clear any previous error message
                }

                // Create User with Email and Password
                auth.createUserWithEmailAndPassword(email, password)
                    .then((userCredential) => {
                        // Signed in
                        const user = userCredential.user;
                        alert("Signup successful! User: " + user.email);
                        // Optionally, redirect to another page
                        window.location.href = "/";
                    })
                    .catch((error) => {
                        const errorCode = error.code;
                        const errorMessageText = error.message;
                        errorMessage.textContent = "Signup failed: " + errorMessageText;
                    });
            });
        }

        const passwordInput = document.getElementById('password');
        const strengthBar = document.getElementById('strengthBar');
        const strengthLabel = document.getElementById('strengthLabel');

        if (passwordInput && strengthBar && strengthLabel) {
            passwordInput.addEventListener('input', function() {
                const password = this.value;
                let strength = 0;
                let strengthText = "Weak";
                let strengthColor = "red";

                // Password strength rules
                const hasMinLength = password.length >= 8;
                const hasLetter = /[a-zA-Z]/.test(password);
                const hasNumber = /[0-9]/.test(password);
                const hasSpecial = /[!@#$%^&*]/.test(password); // Added special character rule

                // Calculate strength based on rules met
                if (hasMinLength) strength += 25;
                if (hasLetter) strength += 25;
                if (hasNumber) strength += 25;
                if (hasSpecial) strength += 25;

                // Determine strength text and color
                if (strength === 100) {
                    strengthText = "Strong";
                    strengthColor = "green";
                } else if (strength >= 75) { // At least 3 out of 4 criteria
                    strengthText = "Medium";
                    strengthColor = "orange";
                } else {
                    strengthText = "Weak";
                    strengthColor = "red";
                }

                strengthBar.style.width = strength + '%';
                strengthBar.style.backgroundColor = strengthColor;
                strengthLabel.textContent = `Strength: ${strengthText}`;
                strengthLabel.style.color = strengthColor;
            });
        }
    </script>
</body>

</html>